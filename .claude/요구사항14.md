# 질문

1. 답변 필드가 좀 더 커야돼. 그리고 Tab(들여쓰기)등 문법도 적용이 되어야 해
2. 이미지 OCR을 거쳐서 결과가 포함된 데이터의 경우 아래와 같이 키워드가 너무 길고 번거로워. 이미지 ocr을 돌려서 모든 텍스트가 다 키워드로 등록이 되어버렸는데 개선할 방법이 있을까?
   아래 답변 제목 하단에 먼저 다른 방법을 제시해줘

````json
  "keywords": [
        "npm",
        "클로드",
        "설치",
        "명령어",
        "넣었는데",
        "이렇게",
        "뜹니다",
        "이미지에서",
        "추출된",
        "텍스트",
        "시스템에서",
        "스크립트를",
        "실행할",
        "없습니다",
        "program",
        "files",
        "nodejs",
        "파일을",
        "로드할",
        "자세한",
        "내용은",
        "policies",
        "https",
        "microsoft",
        "com",
        "fwlink",
        "linkid",
        "참조하십시오",
        "위치",
        "문자",
        "install",
        "anthropic",
        "claude",
        "code",
        "categoryinfo",
        "보안",
        "오류",
        "psunauthorizedaccessexception",
        "fullyqualifiederrorid",
        "unauthorizedaccess",
        "클로드 설치",
        "설치 명령어",
        "명령어 넣었는데",
        "넣었는데 이렇게",
        "이렇게 뜹니다",
        "뜹니다 이미지에서",
        "이미지에서 추출된",
        "추출된 텍스트",
        "텍스트 npm",
        "npm 이",
        "이 시스템에서",
        "시스템에서 스크립트를",
        "스크립트를 실행할",
        "실행할 수",
        "수 없습니다",
        "없습니다 c",
        "c program",
        "program files",
        "files nodejs",
        "nodejs npm",
        "npm ps1",
        "ps1 파일을",
        "파일을 로드할",
        "로드할 수",
        "없습니다 자세한",
        "자세한 내용은",
        "내용은 about_execution",
        "about_execution policies",
        "policies https",
        "https go",
        "go microsoft",
        "microsoft com",
        "com fwlink",
        "fwlink linkid",
        "linkid 135170",
        "135170 를",
        "를 참조하십시오",
        "참조하십시오 위치",
        "위치 줄",
        "1 문자",
        "문자 1",
        "1 npm",
        "npm install",
        "install g",
        "g anthropic",
        "anthropic ai",
        "ai claude",
        "claude code",
        "code categoryinfo",
        "categoryinfo 보안",
        "보안 오류",
        "오류 psunauthorizedaccessexception",
        "psunauthorizedaccessexception fullyqualifiederrorid",
        "fullyqualifiederrorid unauthorizedaccess"
      ],
      ```



# 답변

## 개선 방법 제안

### 현재 문제점
OCR로 추출된 텍스트에서 100개가 넘는 키워드가 생성되고 있습니다:
- 불필요한 단어들(조사, 접속사 등)이 포함: "이", "수", "를" 등
- 모든 단일 단어와 bigram(2개 단어 조합)이 추출됨
- 에러 메시지의 모든 부분이 키워드로 등록됨

### 추천 방법 ⭐

**OCR 텍스트의 경우 LLM 기반 키워드 추출을 강제로 사용**

현재 하이브리드 시스템은 로컬 추출을 먼저 시도하고 신뢰도가 낮을 때만 LLM을 사용합니다. 하지만 OCR 텍스트는 특성상 로컬 추출이 부적합하므로 처음부터 LLM을 사용하는 것이 효과적입니다.

**장점:**
- LLM이 문맥을 이해하고 핵심 키워드만 추출
- 에러 메시지에서 실제 문제와 관련된 용어만 선택
- 불필요한 단어 자동 필터링
- 키워드 개수를 적절하게 조절 (5-10개 정도)

**예시:**
```
원본 OCR 텍스트: "npm 클로드 설치 명령어 넣었는데 이렇게 뜹니다 이 시스템에서 스크립트를 실행할 수 없습니다 c program files nodejs npm ps1 파일을 로드할 수 없습니다..."

LLM 추출 결과: ["npm", "PowerShell", "스크립트 실행", "권한 오류", "Node.js", "설치"]
```

### 대안 방법들

1. **OCR 전용 불용어 확대**
   - 에러 메시지에서 자주 나오는 불필요한 단어 추가
   - 예: "위치", "줄", "문자", "categoryinfo", "fullyqualifiederrorid" 등
   - 단점: 계속 업데이트가 필요하고 모든 경우를 커버하기 어려움

2. **N-gram 완전 제거**
   - OCR 텍스트의 경우 bigram을 아예 생성하지 않음
   - 단점: 복합어("스크립트 실행", "권한 오류" 등)를 놓칠 수 있음

3. **최소 길이 제한 강화**
   - 3글자 미만 한글 단어 제외, 5글자 미만 영문 단어 제외
   - 단점: "npm", "git" 같은 중요한 짧은 용어를 놓칠 수 있음

4. **TF-IDF 기반 중요도 계산**
   - 빈도수와 희소성을 계산하여 중요한 키워드만 선택
   - 단점: 구현이 복잡하고 데이터셋이 필요함

### 구현 방법

`lib/hybrid-keyword-extractor.js`에서 OCR 텍스트인 경우 `forceLLM: true` 옵션을 자동으로 설정:

```javascript
// OCR 텍스트 감지 시 자동으로 LLM 사용
if (isOCR) {
  console.log('🖼️ [Hybrid] OCR text detected - forcing LLM extraction')
  options.forceLLM = true
}
```

또는 호출하는 쪽에서 OCR 텍스트인 경우 명시적으로 `forceLLM: true`를 전달:

```javascript
const result = await extractKeywordsHybrid(ocrText, {
  isOCR: true,
  forceLLM: true  // OCR 텍스트는 LLM 사용
})
```

````
