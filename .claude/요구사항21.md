# 질문

1. 유사도 시스템의 개선이 필요해. 지금 8% 인 유사도도 결과에 나오고 있어. 70% 이상인 것만 나오게 수정해줘
2. 키워드에 지금 불필요한 용어들이 많이 들어가 있어

"keywords": [
"명령",
"한번",
"윈도우",
"여나요",
"캡쳐대",
"프롬프트",
"캡쳐대로",
"윈도우에서",
"명령 프롬프트",
"캡쳐대로 한번",
"윈도우에서 명령",
"여나요 캡쳐대로",
"한번 따라해보실래요"
],

"여나요", "캡쳐대","한번 따라해보실래요", "캡쳐대로 한번", 등은 그냥 일상적인 말일 뿐인데 키워드로 인식되고 있는 것 같아. 키워드 추출 시스템의 개선이 필요해. 지금까지 수정한 로직을 업데이트해서 키워드 추출 시스템에 대해 아래 #답변 필드에 추가해줘

# 답변

## 개선 완료 내용

### 1. 유사도 필터링 개선 (70% 이상만 표시)

**수정 파일**: `app/api/qna/search/route.js`

- **변경 내용**: `minSimilarity` 기본값을 `0.15` (15%)에서 `0.7` (70%)로 상향
- **효과**: 8%와 같은 낮은 유사도의 부정확한 검색 결과가 제거되고, 70% 이상의 높은 관련성을 가진 결과만 표시됩니다.

```javascript
// 변경 전
const { query, category = 'all', maxResults = 3, minSimilarity = 0.15, isOCR = false } = await request.json()

// 변경 후
const { query, category = 'all', maxResults = 3, minSimilarity = 0.7, isOCR = false } = await request.json()
```

---

### 2. 키워드 추출 시스템 개선 (불필요한 일상 용어 제거)

**수정 파일**: `lib/keyword-extractor.js`

#### 2-1. 불용어(STOP_WORDS) 확장

일상 대화에서 사용되는 표현들을 불용어 목록에 추가하여 키워드로 추출되지 않도록 개선했습니다.

**추가된 불용어**:
- 요청 관련: "한번", "주세요", "해주세요", "알려주세요", "가르쳐주세요", "설명해주세요", "말씀해주세요"
- 제안 관련: "따라해보실래요", "해보실래요", "보실래요", "실래요", "해볼래요", "볼래요", "해보세요", "보세요", "해보실", "보실"
- 일상 표현: "여나요", "캡쳐대", "캡쳐대로"
- 예의 표현: "부탁드립니다", "부탁합니다", "감사합니다", "고맙습니다"

**효과**:
- ❌ 제거: "여나요", "캡쳐대", "한번 따라해보실래요", "캡쳐대로 한번" 등
- ✅ 유지: "명령 프롬프트", "윈도우", "PowerShell" 등 기술 용어

#### 2-2. N-gram 생성 로직 강화

N-gram (2단어 조합) 생성 시 **기술 용어가 포함된 구문만** 허용하도록 필터링을 강화했습니다.

**개선 로직**:
```javascript
// 기술 용어가 하나 이상 포함된 n-gram만 허용
const hasTechTerm = ngramWords.some(word => {
  // 영문 3글자 이상 (기술 용어 가능성)
  if (/^[a-zA-Z]{3,}$/.test(word)) return true;
  // 대문자로 시작하는 단어
  if (/^[A-Z]/.test(word)) return true;
  return false;
});

// 기술 용어가 없으면 제외
if (!hasTechTerm) {
  continue;
}
```

**효과**:
- ✅ 허용: "명령 프롬프트", "윈도우에서 node", "vscode 설정"
- ❌ 차단: "한번 따라해보실래요", "여나요 캡쳐대로", "부탁 드립니다"

---

## 키워드 추출 시스템 전체 구조

### 3단계 필터링 시스템

1. **기술 용어 우선 추출**
   - TECH_TERMS 사전에 등록된 용어 (React, Git, VSCode 등) 우선 추출
   - 대소문자 구분 유지

2. **명사 추출 + 불용어 제거**
   - 2글자 이상 한글 명사, 3글자 이상 영문 단어 추출
   - STOP_WORDS에 포함된 일상 용어 제거

3. **N-gram 생성 + 기술 용어 필터링**
   - 2단어 조합 생성
   - 기술 용어가 포함된 구문만 허용
   - 불용어가 포함된 구문 제거

### 하이브리드 추출 방식 (로컬 + LLM)

**파일**: `lib/hybrid-keyword-extractor.js`

1. **로컬 추출 우선** (`keyword-extractor.js`)
   - 비용 없음, 빠른 처리
   - 신뢰도 70% 이상이면 로컬 결과 사용

2. **LLM 백업** (`llm-keyword-extractor.js`)
   - 로컬 신뢰도 70% 미만 시 LLM 호출
   - OCR 텍스트의 경우 LLM 강제 사용 (더 정확한 추출)
   - Claude API 활용

3. **품질 보장**
   - 신뢰도 점수 기반 자동 전환
   - OCR 모드에서는 로컬 + LLM 결과 병합
   - 비용 효율적 운영 (대부분 로컬 처리)

---

## 기대 효과

1. **검색 정확도 향상**: 유사도 70% 이상 필터링으로 관련성 높은 결과만 표시
2. **키워드 품질 개선**: 일상 용어 제거로 기술적으로 의미있는 키워드만 추출
3. **사용자 경험 개선**: 불필요한 검색 결과 감소, 정확한 답변 제공
4. **유지보수 용이**: 불용어 목록을 통한 지속적인 품질 개선 가능
