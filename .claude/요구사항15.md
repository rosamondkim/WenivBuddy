# 질문

현재 코드 흐름에서는 qna-database.json만 실데이터로 사용되고, 카테고리 JSON 파일들은 기능적으로 연결돼 있지 않은 것 같아

1. 실제 검색/표시 데이터 소스: public/data/qna-database.json의 qnaList가 전부
2. /api/qna/search → lib/qna-search.js가 이 파일만 읽어 검색/필터링
3. 카테고리 선택 옵션: components/add-qna-form.jsx, save-answer-dialog.jsx 등에 상수 CATEGORIES로 하드코딩되어 있으며, 파일을 읽지 않음
4. public/data/categories/\*.json: 과거 카테고리별 샘플/백업 데이터로 보이며, 현재 코드에서 참조되지 않습니다(ripgrep 기준 사용처 없음). README에만 경로 안내가 남아 있음

qna-database.json을 삭제하고 카테고리 폴더들만 유지하면 한눈에 데이터를 정리하여 보기 편할 것 같은데, 검색 및 필터링 로직을 어떻게 변경해야할지 추천해줘. 하단 답변 밑에 작성해줘

# 답변

## 현재 상황 분석

### 데이터 스키마 차이

1. **qna-database.json** (현재 사용 중 - 새 스키마):

```json
{
  "id": "qna-001",
  "category": "Terminal",
  "title": "제목",
  "body": "본문",
  "ocrText": null,
  "ocrErrorLine": null,
  "tags": ["VSCode"],
  "keywords": ["키워드"],
  "answer": "답변",
  "author": "작성자",
  "timestamp": "2024-12-01T10:30:00",
  "views": 42
}
```

2. **categories/\*.json** (사용 안 함 - 구 스키마):

```json
{
  "id": "qna-001",
  "category": "도구",
  "question": "질문", // ❌ title, body가 아님
  "keywords": ["키워드"],
  "answer": "답변",
  "author": "작성자",
  "timestamp": "2024-12-01T10:30:00",
  "views": 42
}
```

## 추천 방안 ⭐

### 방안 1: 카테고리별 파일 분리 (추천)

**장점:**

- 데이터를 카테고리별로 관리하기 편함
- 파일 크기가 작아져서 편집이 쉬움
- Git에서 변경사항 추적이 명확함
- 특정 카테고리만 로드/수정 가능

**단점:**

- 초기 로딩 시 여러 파일을 읽어야 함 (성능 영향 미미)
- 파일 구조가 복잡해짐

**구현 방법:**

1. **파일 구조**

```
public/data/categories/
├── front-end.json
├── back-end.json
├── figma.json
├── git-github.json
├── terminal.json
└── 기타.json
```

2. **각 카테고리 파일 형식** (새 스키마 사용)

```json
{
  "category": "Front-end",
  "qnaList": [
    {
      "id": "qna-001",
      "category": "Front-end",
      "title": "...",
      "body": "...",
      "ocrText": null,
      "ocrErrorLine": null,
      "tags": [],
      "keywords": [],
      "answer": "...",
      "author": "...",
      "timestamp": "...",
      "views": 0
    }
  ]
}
```

3. **검색 로직 변경**

**옵션 A: 서버 시작 시 모든 카테고리 로드 (추천)**

```javascript
// lib/qna-loader.js (새 파일)
export function loadAllCategories() {
  const categories = [
    "front-end",
    "back-end",
    "figma",
    "git-github",
    "terminal",
    "기타",
  ];
  const allQnA = [];

  for (const category of categories) {
    const data = JSON.parse(
      fs.readFileSync(`public/data/categories/${category}.json`)
    );
    allQnA.push(...data.qnaList);
  }

  return allQnA;
}

// app/api/qna/search/route.js
const qnaList = loadAllCategories();
```

**옵션 B: 필요한 카테고리만 로드 (최적화)**

```javascript
// 카테고리가 선택된 경우 해당 파일만 로드
if (category !== "all") {
  const data = JSON.parse(
    fs.readFileSync(`public/data/categories/${category}.json`)
  );
  qnaList = data.qnaList;
} else {
  qnaList = loadAllCategories();
}
```

4. **Q&A 추가 로직 변경**

```javascript
// app/api/qna/add/route.js
// 해당 카테고리 파일을 읽고 수정
const categoryFile = `public/data/categories/${category.toLowerCase()}.json`;
const data = JSON.parse(fs.readFileSync(categoryFile));
data.qnaList.push(newQnA);
fs.writeFileSync(categoryFile, JSON.stringify(data, null, 2));
```

### 방안 2: 현재 구조 유지 (대안)

qna-database.json을 그대로 사용하고, categories 폴더는 백업/카테고리별 내보내기 용도로 사용

**장점:**

- 코드 변경 최소화
- 단일 파일 관리로 간단함

**단점:**

- 파일이 커지면 편집이 불편함
- 카테고리별 관리가 어려움
