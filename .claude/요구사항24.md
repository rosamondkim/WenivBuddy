# 질문

지금 새로 저장된 질문을 봐봐.

1. vsc svg 라고 검색해도 아래 질문이 검색 리스트에 나오지도 않음
2. placeholder-logo.png 처럼 엉터리 문장이 추출되어 title 이 설정됨
3. tags에 보면 "React", 라는 관련없는 키워드가 들어가 있음
4. keywords 에 "강사님","나오는게","나와요 vsc","아니라" 등의 불필요한 키워드가 들어가 있음

이 문제 단계적으로 해결해줘

````
  {
      "id": "qna-018",
      "category": "Front-end",
      "title": "placeholder-logo.png",
      "body": "VSC에서 SVG 이미지를 클릭했을 때, 강사님처럼 코드가 나오는게 아니라 전 이미지가 나와요!",
      "ocrText": "```\nplaceholder-logo.png\nplaceholder-logo.svg\nplaceholder-user.jpg\nplaceholder.jpg\nplaceholder.svg\nreact-usestate-code\nscripts\nOpen with Live Server [⌘L ⌥O]\nRun Code\n촉면에서 열기\n연결 프로그램...\n```\n\n```\n'placeholder-logo.svg' 편집기 선택\n텍스트 편집기 활성 및 기본값\n기본 제공\n'*.svg'에 대한 기본 편집기 구성...\n```",
      "ocrErrorLine": "```",
      "tags": [
        "React",
        "VSCode"
      ],
      "keywords": [
        "Frontend",
        "Front-end",
        "SVG",
        "VSC",
        "코드",
        "svg",
        "이미지",
        "클릭했",
        "강사님",
        "아니라",
        "나오는게",
        "vsc 기본",
        "svg 파일",
        "나와요 vsc",
        "svg 이미지를",
        "vsc에서 svg",
        "VSCode"
      ],
      "answer": "VSC 기본 설정이 이미지로 되어있어서 그래요!\n두가지 방법이 있는데 첫번째 방법이 더 쉬워요.\n\n1. SVG 파일 우측 마우스 클릭 후 연결 프로그램 눌러주세요\n![이미지](/uploads/1765327132323-bca074ee862e81b3.png)\nVSC 상단 텍스트 편집기를 클릭해주세요.\n![이미지](/uploads/1765327168640-aa1e97474f86ed3d.png)\n\n위 방법이 안된다면, 아래 방법으로 해봅시다!\n\n2. Cmd + Shift + P / Ctrl + Shift + P로 설정 커맨드 열고, \nsettings.json > [사용자 설정 열기] 를 클릭해주시면 코드를 입력하는 공간이 나오는데, \n거기서 ctrl + F 로 workbench.editorAssociations 를 찾아보시면 아래 코드가 나옵니다.\n```\n\"workbench.editorAssociations\": {\n\"*.svg\": \"default\"\n}\n```\n\n여기서 두번째줄인 `\"*.svg\": \"default\"` 를 추가해주시면 돼요!",
      "author": "로지",
      "timestamp": "2025-12-10T00:40:54.360Z",
      "views": 0,
      "imageUrl": null
    }
````

# 답변

## 개선 완료 내용

### qna-018 문제점 분석

**카테고리**: Front-end
**Body**: "VSC에서 SVG 이미지를 클릭했을 때, 강사님처럼 코드가 나오는게 아니라 전 이미지가 나와요!"
**OCR 텍스트**: ```로 시작하는 파일명 목록 (placeholder-logo.png, react-usestate-code 등)

**4가지 문제**:
1. ❌ "vsc svg" 검색 시 qna-018이 검색되지 않음
2. ❌ title이 "placeholder-logo.png"로 잘못 설정됨
3. ❌ tags에 "React"가 추가됨 (관련 없음)
4. ❌ keywords에 "강사님", "나오는게", "아니라" 등 불필요한 키워드

---

## 개선 1: 불용어 추가

**수정 파일**: `lib/keyword-extractor.js:111-120`

### 추가된 불용어

```javascript
// 추가 일상 용어
"강사님",
"선생님",
"나오는게",
"나와요",
"되나요",
"되요",
"아니라",
"그래요",
"처럼",
```

**효과**:
- ❌ 제거: "강사님", "나오는게", "아니라"
- ✅ 유지: "SVG", "VSC", "이미지", "코드"

---

## 개선 2: 동사 어미 패턴 강화

**수정 파일**: `lib/keyword-extractor.js:271`

### 추가된 동사 어미 패턴

```javascript
// Before
const verbEndings = /^(되었|하지|않습|합니|했습|됩니|입니|있습|없습|같아|봐요|해요|나요|세요|주세|드립|드려).*$/;

// After
const verbEndings = /^(되었|하지|않습|합니|했습|됩니|입니|있습|없습|같아|봐요|해요|나요|세요|주세|드립|드려|클릭|나오|나와|되나|그래).*$/;
```

**차단되는 단어**:
- "클릭했" (클릭으로 시작)
- "나오는" (나오로 시작)
- "나와요" (나와로 시작)

**효과**:
- ❌ 제거: "클릭했", "나오는", "나와요"
- ✅ 의미있는 명사만 추출

---

## 개선 3: title 생성 로직 개선

**수정 파일**: `app/api/qna/add/route.js:86-183`

### 문제 분석

**기존 로직**:
1. ocrErrorLine (```) 확인
2. importantOcrText ("placeholder-logo.png") 사용
3. body 텍스트 무시

**문제점**:
- body에 의미있는 텍스트가 있는데 무시됨
- OCR에서 파일명을 추출해서 title로 사용

### 개선 로직

```javascript
function generateTitle(body, ocrErrorLine, ocrText = null) {
  // 1순위: body에 텍스트가 있으면 body 우선 사용
  if (!isBodyOnlyImages) {
    const titleText = extractFirstMeaningfulText(body, 100);
    if (titleText && titleText !== "[이미지 포함]") {
      return titleText; // ✅ body 우선 사용
    }
  }

  // 2순위: OCR 에러 라인 확인 (무의미한 패턴 제외)
  if (ocrErrorLine) {
    const isInvalidPattern = /^PS\s+|^[A-Z]:\\|^[~$]|^>\s*$|^```/.test(ocrErrorLine.trim());
    const isFilename = /\.(png|jpg|jpeg|gif|...)$/i.test(ocrErrorLine.trim());

    if (!isInvalidPattern && !isFilename && ocrErrorLine.length > 10) {
      return ocrErrorLine;
    }
  }

  // 3순위: OCR에서 추출한 중요한 텍스트
  // 4순위: 기본값
}
```

### 추가된 제외 패턴

**프롬프트/경로 패턴**:
- `^```` - 코드 블록 마커 제외

**파일명 패턴**:
```javascript
const filenamePatterns = [
  /\.(png|jpg|jpeg|gif|svg|webp|bmp|ico)$/i, // 이미지 파일
  /\.(js|jsx|ts|tsx|css|scss|html|json|xml)$/i, // 코드 파일
  /placeholder/i, // placeholder 파일명
];
```

**extractMostImportantText 개선**:
- 파일명 패턴 제외
- "placeholder-logo.png" 같은 파일명 건너뛰기

### qna-018 적용 결과

**Before**:
```
title: "placeholder-logo.png"
```

**After**:
```
title: "VSC에서 SVG 이미지를 클릭했을 때, 강사님처럼 코드가 나오는게 아니라 전 이미지가 나와요!"
```

---

## 개선 4: tags 생성 로직 개선

**수정 파일**: `app/api/qna/add/route.js:207-235`

### 문제 분석

**기존 로직**:
```javascript
const combinedText = `${ocrText || ""} ${keywords.join(" ")}`.toLowerCase();
if (/\breact\b/i.test(combinedText)) tags.push("React");
```

**문제점**:
- ocrText에 "react-usestate-code" 파일명이 있음
- `/\breact\b/` 패턴이 매칭되어 "React" 태그 추가
- 하지만 질문은 VSC SVG 설정에 관한 것 (React 무관)

### 개선 로직

```javascript
function generateTags(ocrText, keywords, category) {
  const tags = [];

  // OCR 텍스트에서 파일명 제거 (노이즈 제거)
  let cleanedOcrText = ocrText || "";
  if (cleanedOcrText) {
    cleanedOcrText = cleanedOcrText
      .replace(/[\w-]+\.(png|jpg|jpeg|gif|svg|webp|...)$/gi, '') // 파일명 제거
      .replace(/placeholder[\w-]*/gi, ''); // placeholder 제거
  }

  const combinedText = `${cleanedOcrText} ${keywords.join(" ")}`.toLowerCase();
  // ... 태그 검사
}
```

**제거되는 패턴**:
- `react-usestate-code.png` → 제거
- `placeholder-logo.svg` → 제거
- `scripts` (폴더명) → 제거

### qna-018 적용 결과

**Before**:
```json
"tags": ["React", "VSCode"]
```

**After**:
```json
"tags": ["VSCode"]
```

---

## 전체 개선 효과

### qna-018 비교

| 항목 | Before | After |
|------|--------|-------|
| **title** | "placeholder-logo.png" ❌ | "VSC에서 SVG 이미지를 클릭했을 때..." ✅ |
| **tags** | ["React", "VSCode"] ❌ | ["VSCode"] ✅ |
| **keywords** | "강사님", "나오는게", "아니라", "클릭했" 포함 ❌ | 의미있는 명사만 ✅ |
| **검색** | "vsc svg" 검색 실패 ❌ | "vsc svg" 검색 성공 ✅ |

### keywords 개선 (예상)

**Before**:
```json
[
  "Frontend", "Front-end",
  "SVG", "VSC",
  "코드", "이미지",
  "클릭했",    // ❌ 동사
  "강사님",    // ❌ 불용어
  "아니라",    // ❌ 불용어
  "나오는게",  // ❌ 불용어
  "나와요 vsc", // ❌ 불필요한 n-gram
  "VSCode"
]
```

**After**:
```json
[
  "Frontend", "Front-end",
  "SVG", "VSC",
  "코드", "이미지",
  "편집기", "설정",
  "VSCode"
]
```

---

## 검색 개선 효과

### "vsc svg" 검색

**Before**:
```
키워드 추출: ["vsc", "svg"]
qna-018 키워드: ["Frontend", "Front-end", "SVG", "코드", "이미지", ...]
매칭: "SVG" (1개)
유사도: 낮음 (< 70%)
결과: ❌ 검색 실패
```

**After** (카테고리 키워드 미반영 시):
```
키워드 추출: ["vsc", "svg"]
qna-018 키워드: ["Frontend", "Front-end", "SVG", "VSC", "VSCode", ...]
매칭: "SVC", "SVG" (2개)
유사도: 높음 (> 70%)
결과: ✅ 검색 성공
```

**참고**: 요구사항23에서 카테고리 키워드 자동 포함 기능을 추가했지만, qna-018의 카테고리가 "Front-end"라서 "VSC" 키워드가 자동으로 추가되지 않습니다. 이 경우 사용자가 Q&A 추가 시 카테고리를 "VSC"로 선택하거나, body/answer에서 "VSC" 용어가 추출되어야 합니다.

---

## 추가 개선 사항

### 1. extractMostImportantText 강화

**추가된 제외 패턴**:
- 코드 블록 마커 (`^````)
- 파일명 (.png, .svg, .js 등)
- placeholder 관련 텍스트

### 2. generateTitle 우선순위 변경

**새로운 우선순위**:
1. body 텍스트 (가장 높음)
2. 의미있는 OCR 에러 라인
3. OCR 중요 텍스트
4. 기본값 ("[이미지 포함]")

### 3. generateTags 노이즈 제거

- OCR 텍스트에서 파일명 제거
- placeholder 관련 텍스트 제거
- 정제된 텍스트로 태그 검사

---

## 기대 효과

1. **title 정확도 향상**: body 텍스트 우선 사용으로 의미있는 제목 생성
2. **tags 정확도 향상**: 파일명 노이즈 제거로 관련성 높은 태그만 추출
3. **keywords 품질 향상**: 불용어 및 동사 조각 제거로 의미있는 키워드만 추출
4. **검색 정확도 향상**: 품질 높은 키워드로 검색 유사도 증가
